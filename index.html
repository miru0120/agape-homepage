import React, { useState, useEffect, useRef } from 'react'; // React Hooks をインポート
import { Search, DollarSign, ShieldCheck, Package } from 'lucide-react'; // Search, DollarSign, ShieldCheck, Package アイコンをインポート

// メインアプリケーションコンポーネント
const App = () => {
  // グローバルナビゲーションが固定された際の高さと、固定されているかどうかの状態を管理するstate
  const [stickyNavHeight, setStickyNavHeight] = useState(0);
  const [isGlobalNavSticky, setIsGlobalNavSticky] = useState(false);

  // Headerコンポーネントからstickyの状態と高さを更新するためのコールバック関数
  const updateStickyNavState = (sticky, height) => {
    setIsGlobalNavSticky(sticky);
    setStickyNavHeight(height);
  };

  return (
    <div className="font-sans antialiased text-gray-800 bg-white">
      {/* グローバルフォント設定 */}
      <style>{`
        /* Noto Sans JP フォントの読み込み */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&display=swap');

        body {
          font-family: "Noto Sans JP", "游ゴシック", "Yu Gothic", "Meiryo", sans-serif;
        }
      `}</style>

      {/* ヘッダーコンポーネントにstickyの状態を更新する関数を渡す */}
      <Header updateStickyNavState={updateStickyNavState} />
      {/* ヒーローセクションをヘッダーの直下に移動 */}
      <HeroSection />
      {/* メインコンテンツに、グローバルナビゲーションがstickyになった場合のみパディングを適用 */}
      <div style={{ paddingTop: isGlobalNavSticky ? `${stickyNavHeight}px` : '0px' }}>
        <ServicesSection />
        <StrengthsSection />
        <CompanyProfileSection />
        <FAQSection />
        <WasteSeparationAssistant />
        <ContactSection />
      </div>
      {/* フッターコンポーネント */}
      <Footer />
      {/* モバイル固定フッターボタンを追加 */}
      <MobileFixedFooterButtons />
    </div>
  );
};

// ヘッダーコンポーネント
const Header = ({ updateStickyNavState }) => {
  const [isOpen, setIsOpen] = useState(false); // ハンバーガーメニューの開閉状態を管理
  const [isGlobalNavVisible, setIsGlobalNavVisible] = useState(true); // グローバルナビゲーションの表示状態 (opacity)
  const [lastScrollY, setLastScrollY] = useState(0); // 前回のスクロール位置を記憶

  const topBarRef = useRef(null); // トップバー要素への参照
  const globalNavRef = useRef(null); // グローバルナビゲーション要素への参照

  // スクロールイベントを監視し、グローバルナビゲーションの表示とAppへのsticky状態の通知を切り替える
  useEffect(() => {
    const handleScroll = () => {
      const currentScrollY = window.scrollY; // 現在のスクロール位置
      const heroSectionThreshold = window.innerHeight / 2; // ヒーローセクションの半分を閾値とする

      // グローバルナビゲーションがstickyになるオフセット位置を計算
      const initialGlobalNavOffsetTop = topBarRef.current ? topBarRef.current.offsetHeight : 0;
      const globalNavHeight = globalNavRef.current ? globalNavRef.current.offsetHeight : 0;

      // Appコンポーネントにstickyの状態と高さを通知
      const isSticky = currentScrollY >= initialGlobalNavOffsetTop;
      updateStickyNavState(isSticky, globalNavHeight);

      // グローバルナビゲーションの表示ロジック (opacity)
      // 1. 最上部 (0px) では常に表示
      // 2. スクロールアップ中は常に表示
      // 3. ヒーローセクションの半分を超えてスクロールダウンしたら表示
      // 4. それ以外 (トップバーがスクロールアウトし、ヒーローセクション半分未満をスクロールダウンしている場合) は非表示
      if (currentScrollY === 0) { // 最上部
        setIsGlobalNavVisible(true);
      } else if (currentScrollY < lastScrollY) { // スクロールアップ中
        setIsGlobalNavVisible(true);
      } else if (currentScrollY > heroSectionThreshold) { // ヒーローセクションの半分を超えてスクロールダウン
        setIsGlobalNavVisible(true);
      } else { // その他のスクロールダウン時
        setIsGlobalNavVisible(false);
      }

      setLastScrollY(currentScrollY); // 現在のスクロール位置を更新
    };

    // 初期表示時にstickyの状態と高さを設定
    const setInitialStickyState = () => {
      const initialGlobalNavOffsetTop = topBarRef.current ? topBarRef.current.offsetHeight : 0;
      const globalNavHeight = globalNavRef.current ? globalNavRef.current.offsetHeight : 0;
      const isSticky = window.scrollY >= initialGlobalNavOffsetTop;
      updateStickyNavState(isSticky, globalNavHeight);
    };
    setInitialStickyState(); // コンポーネントマウント時に一度実行

    // スクロールとリサイズイベントリスナーを追加
    window.addEventListener('scroll', handleScroll);
    window.addEventListener('resize', setInitialStickyState); // ウィンドウリサイズ時にも再計算
    // コンポーネントのアンマウント時にイベントリスナーをクリーンアップ
    return () => {
      window.removeEventListener('scroll', handleScroll);
      window.removeEventListener('resize', setInitialStickyState);
    };
  }, [lastScrollY, updateStickyNavState]); // lastScrollY と updateStickyNavState が変更された時に再実行

  // モバイルメニューのtop位置を動的に計算 (常にビューポートの最上部に固定)
  const mobileMenuCalculatedTop = 0;

  // ハンバーガーメニューのパスデータを条件によって切り替える (開いている時はX、閉じている時は三本線)
  const menuIconPathD = isOpen ? "M6 18L18 6M6 6l12 12" : "M4 6h16M4 12h16M4 18h16";

  return (
    <>
      {/* トップバー: ロゴと問い合わせ情報 */}
      <div id="top-bar" ref={topBarRef} className={`bg-white border-b border-gray-200 z-50`}>
        <div className="bg-white py-3 px-4">
          <div className="container mx-auto flex flex-col md:flex-row justify-between items-center">
            {/* ロゴと会社名 */}
            <div className="flex items-center space-x-3 mb-2 md:mb-0">
              {/* インターネット上の公開URLのロゴ画像を埋め込みました */}
              <img src="https://i.ibb.co/4wzx6L6g/kabuagape.png" alt="株式会社AGAPE ロゴ" className="h-16 object-contain" /> {/* 高さをh-16に調整 */}
            </div>

            {/* 問い合わせ情報 (デスクトップ版のみ表示) */}
            <div className="hidden md:flex items-center space-x-4">
              <div className="flex items-center text-gray-700">
                <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                <span className="font-semibold">0120-86-0053</span>
              </div>
              <a href="#contact" className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition duration-300">
                お問い合わせ
              </a>
            </div>
          </div>
        </div>
      </div>

      {/* グローバルナビゲーション本体 */}
      {/* sticky top-0 で固定、opacity で表示を制御 */}
      <nav id="global-nav" ref={globalNavRef}
           className={`sticky top-0 bg-white border-b border-gray-200 z-40 transition-opacity duration-300
                       ${isGlobalNavVisible ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
        <div className="container mx-auto px-4 py-3 flex justify-center items-center">
          {/* ナビゲーションリンク (デスクトップ版のみ表示) */}
          <div className="hidden md:flex space-x-6">
            <NavLink href="#home">ホーム</NavLink>
            <NavLink href="#services">事業内容</NavLink>
            <NavLink href="#strengths">当社の強み</NavLink>
            <NavLink href="#company">会社概要</NavLink>
            <NavLink href="#faq">よくある質問</NavLink>
            <NavLink href="#waste-assistant">ごみのお悩み検索</NavLink>
            <NavLink href="#contact">お問い合わせ</NavLink>
          </div>
          {/* ハンバーガーメニューボタン (モバイル版のみ表示) */}
          <div className="md:hidden">
            <button onClick={() => setIsOpen(!isOpen)} className="text-gray-800 focus:outline-none flex items-center">
              <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={menuIconPathD} />
              </svg>
              <span className="ml-2 text-lg font-semibold">メニュー</span>
            </button>
          </div>
        </div>
      </nav>

      {/* モバイルメニュー (isOpenがtrueの時のみ表示) */}
      {isOpen && (
        <div className="md:hidden fixed w-full bg-white py-4 shadow-lg z-50"
             style={{ top: `${mobileMenuCalculatedTop}px` }}>
          <MobileNavLink href="#home" onClick={() => setIsOpen(false)}>ホーム</MobileNavLink>
          <MobileNavLink href="#services" onClick={() => setIsOpen(false)}>事業内容</MobileNavLink>
          <MobileNavLink href="#strengths" onClick={() => setIsOpen(false)}>当社の強み</MobileNavLink>
          <MobileNavLink href="#company" onClick={() => setIsOpen(false)}>会社概要</MobileNavLink>
          <MobileNavLink href="#faq" onClick={() => setIsOpen(false)}>よくある質問</MobileNavLink>
          <MobileNavLink href="#waste-assistant" onClick={() => setIsOpen(false)}>ごみのお悩み検索</MobileNavLink>
          <MobileNavLink href="#contact" onClick={() => setIsOpen(false)}>お問い合わせ</MobileNavLink>
        </div>
      )}
    </>
  );
};

// ナビゲーションリンクの共通コンポーネント (デスクトップ用)
const NavLink = ({ href, children }) => (
  <a href={href} className="text-gray-700 hover:text-blue-600 transition duration-300 font-medium">
    {children}
  </a>
);

// ナビゲーションリンクの共通コンポーネント (モバイル用)
const MobileNavLink = ({ href, onClick, children }) => (
  <a href={href} onClick={onClick} className="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition duration-300">
    {children}
  </a>
);

// ヒーローセクションコンポーネント
const HeroSection = () => {
  // 背景画像URLをレスポンシブに設定
  const mobileBackgroundImage = "https://i.ibb.co/jFqW8mg/mobile-agape.png"; // モバイル用
  const desktopBackgroundImage = "https://i.ibb.co/27C9V2Xj/agapeff.png"; // デスクトップ用

  // 現在の画面幅を監視するstate
  const [currentWidth, setCurrentWidth] = useState(window.innerWidth);

  // リサイズイベントリスナーを設定
  useEffect(() => {
    const handleResize = () => {
      setCurrentWidth(window.innerWidth);
    };
    window.addEventListener('resize', handleResize);
    return () => {
      window.removeEventListener('resize', handleResize);
    };
  }, []);

  // 画面幅に基づいて適用する背景画像を決定
  const backgroundImageStyle = {
    backgroundImage: `url(${currentWidth < 768 ? mobileBackgroundImage : desktopBackgroundImage})`,
    backgroundSize: 'cover',
    backgroundPosition: 'center',
  };

  return (
    <section id="home" className="relative h-screen flex items-center justify-center text-white overflow-hidden">
      {/* 背景画像をセクション全体に設定（レスポンシブ対応） */}
      <div className="absolute inset-0" style={backgroundImageStyle}></div>

      {/* テキストコンテンツとボタンを配置 */}
      <div className="relative z-10 text-left p-6 max-w-lg md:max-w-xl lg:max-w-2xl mx-auto md:ml-0 md:pl-20">
        <p className="text-sm md:text-base font-semibold text-white mb-2 animate-fade-in-up">
          HELPING YOU WHOLEHEARTEDLY
        </p>
        <h1 className="text-3xl md:text-5xl font-extrabold leading-tight mb-4 animate-fade-in-up text-white"
            style={{ fontFamily: '"Noto Sans JP", sans-serif', fontWeight: 900 }}>
          廃棄物処理を<br />ストレスフリーに。
        </h1>
        <p className="text-lg md:text-xl mb-6 animate-fade-in-up delay-100 text-white">
          株式会社AGAPEリサイクルは、お客様一人ひとりに寄り添い、安心の低価格で迅速に解決いたします。
        </p>
        <a href="#contact"
           className="inline-block border-2 border-gray-700 bg-[#f0e1ce] text-gray-800 font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 transform hover:scale-105 animate-fade-in-up delay-300">
          まずはお気軽にご相談ください
        </a>
      </div>
    </section>
  );
};

// 事業内容セクションコンポーネント
const ServicesSection = () => {
  const services = [
    { title: "店舗＆事務所整理", description: "店舗や事務所の移転・閉鎖に伴う不用品や廃棄物を一括で回収・処分いたします。", type: "corporate", badge: null },
    { title: "廃棄物管理コンサルティング", description: "廃棄物の適正処理やコスト削減に関するコンサルティングを提供し、最適な管理体制を構築します。", type: "corporate", badge: null },
    { title: "資源物リサイクル", description: "古紙、金属、プラスチックなど、様々な資源物の回収とリサイクルを推進し、環境負荷低減に貢献します。", type: "corporate", badge: null },
    { title: "機密文書処理", description: "情報漏洩リスクを最小限に抑え、安全かつ確実に機密文書を処理・溶解いたします。", type: "corporate", badge: null },
    { title: "OA機器・家電リサイクル", description: "オフィスで使用されたOA機器やご家庭の家電製品を適正にリサイクル処理します。", type: "corporate" },
    { title: "お片づけ＆不用品回収", description: "ご家庭の不用品や粗大ゴミを一点からでも回収し、お部屋をスッキリと片付けます。", type: "individual", badge: null },
    { title: "お引越し＆粗大ゴミ片付け", description: "引越し時の大量のゴミや不用品をまとめて回収し、スムーズな引越しをサポートします。", type: "individual", badge: null },
    { title: "遺品整理", description: "故人の大切な遺品を、ご遺族の心に寄り添いながら丁寧に整理・片付けいたします。", type: "individual", badge: null },
  ];

  return (
    <section id="services" className="py-16 bg-gray-50">
      <div className="container mx-auto px-4">
        <h2 className="text-3xl md:text-4xl font-bold text-center mb-12 text-blue-700">事業内容</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {services.map((service, index) => (<ServiceCard key={index} service={service} />))}
        </div>
      </div>
    </section>
  );
};

// サービスカードコンポーネント
const ServiceCard = ({ service }) => {
  const bgColorClass = service.type === "corporate" ? "bg-gray-100" : "bg-green-50";
  const textColorClass = service.type === "corporate" ? "text-gray-800" : "text-green-800";
  return (
    <div className={`relative p-6 rounded-lg shadow-md ${bgColorClass} hover:shadow-lg transition duration-300`}>
      <h3 className="text-xl font-semibold mb-3 text-blue-600">{service.title}</h3>
      <p className={`text-base ${textColorClass}`}>{service.description}</p>
    </div>
  );
};

// 当社の強みセクションコンポーネント
const StrengthsSection = () => {
  const strengths = [
    {
      title: "当社独自のシステムで低料金・最安値を実現！",
      description: "中間マージンを徹底的に排除し、効率的な回収・処理システムを構築することで、お客様に圧倒的な安値でサービスを提供しています。",
      icon: (<DollarSign className="w-12 h-12 text-blue-500 mb-4" />),
    },
    {
      title: "法令遵守と確かな許認可で安心",
      description: "廃棄物処理法をはじめとする関連法令を厳守し、適正な処理を行います。以下の主要な許認可を保有しており、安心してお任せいただけます。",
      icon: (<ShieldCheck className="w-12 h-12 text-green-500 mb-4" />),
      details: [
        "古物商許可 (大阪府公安委員会 第622260135532号)",
        "金属くず商許可 (大阪府公安委員会 第5533号)",
        "産業廃棄物収集運搬業許可 (大阪府 第112100051号)",
      ],
    },
    {
      title: "不用品1点～大量ゴミまで！幅広い対応力",
      description: "ご家庭の不用品1点から、オフィスや店舗の大量の廃棄物まで、規模の大小に関わらず柔軟に対応いたします。どんなお困りごとでもご相談ください。",
      icon: (<Package className="w-12 h-12 text-purple-500 mb-4" />),
    },
  ];

  return (
    <section id="strengths" className="py-16 bg-white">
      <div className="container mx-auto px-4">
        <h2 className="text-3xl md:text-4xl font-bold text-center mb-12 text-blue-700">当社の強み</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
          {strengths.map((strength, index) => (
            <div key={index} className="p-6 rounded-lg shadow-md bg-gray-50 flex flex-col items-center text-center">
              {strength.icon}
              <h3 className="text-xl font-semibold mb-3 text-blue-600">{strength.title}</h3>
              <p className="text-base text-gray-700 mb-4">{strength.description}</p>
              {strength.details && (
                <ul className="list-disc list-inside text-sm text-gray-600 space-y-1">
                  {strength.details.map((detail, i) => (<li key={i}>{detail}</li>))}
                </ul>
              )}
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};

// 会社概要セクションコンポーネント
const CompanyProfileSection = () => {
  // Googleマップの埋め込みURLを更新し、赤いピンと情報ウィンドウを自動表示するように設定
  // 会社名と住所をクエリとして使用することで、Googleマップが地点を特定し、
  // 自動的にピンと情報ウィンドウ（吹き出し）を表示するように動作します。
  const mapEmbedUrl = "https://maps.google.com/maps?q=%E6%A0%AA%E5%BC%8F%E4%BC%9A%E7%A4%BEAGAPE%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB%2C%20%E5%A4%A7%E9%98%AA%E5%BA%9C%E4%BA%A4%E9%87%8E%E5%B8%82%E6%9D%B1%E5%80%89%E6%B2%BB3%E4%B0%81%E7%9B%AE14-6&t=&z=17&ie=UTF8&iwloc=&output=embed";

  return (
    <section id="company" className="py-16 bg-gray-50">
      <div className="container mx-auto px-4">
        <h2 className="text-3xl md:text-4xl font-bold text-center mb-12 text-blue-700">会社概要</h2>
        <div className="bg-white p-6 rounded-lg shadow-md max-w-3xl mx-auto overflow-x-auto"> {/* ここにoverflow-x-autoを追加 */}
          <table className="min-w-full divide-y divide-gray-200">
            <tbody className="bg-white divide-y divide-gray-200">
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 w-1/3">会社名</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">株式会社AGAPEリサイクル</td>
              </tr>
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">所在地</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  〒576-0061 大阪府交野市東倉治3丁目14-6
                  {/* Google Maps埋め込み */}
                  <div className="mt-4 w-full h-64 md:h-80 lg:h-96"> {/* レスポンシブなコンテナ */}
                    <iframe
                      src={mapEmbedUrl} // 更新された埋め込みURLを使用
                      width="100%"
                      height="100%"
                      style={{ border: 0, borderRadius: '8px' }}
                      allowFullScreen=""
                      loading="lazy"
                      referrerPolicy="no-referrer-when-downgrade"
                      title="AGAPEリサイクル所在地マップ"
                    ></iframe>
                  </div>
                </td>
              </tr>
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">代表者</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">代表取締役 佐々木隆雄</td>
              </tr>
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">設立年月日</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">令和7年7月7日</td>
              </tr>
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">資本金</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">500万円</td>
              </tr>
              <tr>
                <td className="px-6 py-4 text-sm font-medium text-gray-900">事業内容</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  不用品回収、粗大ゴミ回収、遺品整理、生前整理、店舗・オフィス整理、産業廃棄物収集運搬、資源物リサイクル、機密文書処理、廃棄物管理コンサルティング
                </td>
              </tr>
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">許認可</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  古物商許可 (大阪府公安委員会 第622260135532号)<br/>
                  金属くず商許可 (大阪府公安委員会 第5533号)<br/>
                  産業廃棄物収集運搬業許可 (大阪府 第112100051号)
                </td>
              </tr>
              {/* 追加情報: 営業時間 */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">営業時間</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">9:00～18:00</td>
              </tr>
              {/* 追加情報: 休業日を営業時間の下に移動 */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">休業日</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">水曜日</td>
              </tr>
              {/* 追加情報: 決済方法 */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">決済方法</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  Visa、Mastercard、American Express、JCB、Diners Club、DISCOVER、iD、QUICPay、Apple Pay、PayPay、Suica、PASMO、Kitaca、TOICA、manaca、ICOCA、SUGOCA、nimoca、はやかけん<br />
                  ※ PiTaPaはご利用いただけません。
                </td>
              </tr>
              {/* 追加情報: ホームページ */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">ホームページ</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  <a href="https://agape550.wixsite.com/agape" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">https://agape550.wixsite.com/agape</a><br />
                  <a href="https://www.agpe53.com/" target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">https://www.agpe53.com/</a>
                </td>
              </tr>
              {/* 追加情報: 駐車場 */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">駐車場</td>
                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">有り</td>
              </tr>
              {/* 追加情報: アクセス */}
              <tr>
                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">アクセス</td>
                <td className="px-6 py-4 text-sm text-gray-700">
                  **交野本社**<br />
                  JR学研都市線・津田駅
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>
  );
};

// よくある質問セクションコンポーネント
const FAQSection = () => {
  const faqs = [
    { question: "産業廃棄物の収集運搬の流れを教えてください。", answer: "お問い合わせ後、まずはお見積もりをさせていただきます。ご契約後、お客様のご都合に合わせて回収に伺い、適正に運搬・処理いたします。", }, // 電子マニフェスト対応の記述を削除
    { question: "不用品一点からでも回収してもらえますか？", answer: "はい、不用品一点からでも喜んで回収に伺います。お気軽にご相談ください。量に関わらず、お客様のニーズに合わせた柔軟な対応を心がけております。", }, // 句読点を修正
    { question: "見積もりは無料ですか？また、本当に低料金で利用できますか？", answer: "はい、お見積もりは無料です。当社独自の効率的なシステムと中間マージンの排除により、お客様に納得の低料金でサービスを提供しています。", }, // 句読点を修正
    { question: "許可証は持っていますか？信頼できる会社ですか？", answer: "はい, 当社は古物商許可、金属くず商許可、産業廃棄物収集運搬業許可など、事業に必要な各種許認可を全て取得しております。法令遵守を徹底し、お客様に安心と信頼を提供することをお約束いたします。", },
  ];

  return (
    <section id="faq" className="py-16 bg-white">
      <div className="container mx-auto px-4">
        <h2 className="text-3xl md:text-4xl font-bold text-center mb-12 text-blue-700">よくある質問</h2>
        <div className="max-w-3xl mx-auto space-y-4">
          {faqs.map((faq, index) => (<AccordionItem key={index} question={faq.question} answer={faq.answer} />))}
        </div>
      </div>
    </section>
  );
};

// アコーディオンアイテムコンポーネント
const AccordionItem = ({ question, answer }) => {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div className="border border-gray-200 rounded-lg shadow-sm">
      <button
        className="flex justify-between items-center w-full p-5 text-lg font-semibold text-left text-gray-800 bg-gray-50 hover:bg-gray-100 focus:outline-none rounded-t-lg"
        onClick={() => setIsOpen(!isOpen)}
      >
        <span>{question}</span>
        <svg
          className={`w-6 h-6 transform transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      {isOpen && (
        <div className="p-5 text-base text-gray-700 bg-white rounded-b-lg">
          {answer}
        </div>
      )}
    </div>
  );
};

// 廃棄物分別アシスタントセクションコンポーネント (Gemini API 連携)
const WasteSeparationAssistant = () => {
  const [item, setItem] = useState('');
  const [disposalInfo, setDisposalInfo] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const getDisposalInfo = async () => {
    if (!item.trim()) {
      setDisposalInfo('何かお困りごとの内容を入力してください。');
      return;
    }

    setIsLoading(true);
    setDisposalInfo('');

    try {
      let chatHistory = [];
      const prompt = `お客様からの「お困りごと」に対して、適切な解決策や関連サービス、または一般的な廃棄方法を日本の自治体のルールに沿って簡潔に提案してください。AGAPEリサイクルのサービス（不用品回収、粗大ゴミ回収、遺品整理、生前整理、店舗・オフィス整理、産業廃棄物収集運搬、資源物リサイクル、機密文書処理、廃棄物管理コンサルティング、ゴミ屋敷清掃、特殊清掃、消毒・消臭など）で対応可能な場合は、その旨を積極的に案内し、お問い合わせを促してください。

      例1: ゴミ屋敷 -> 回答: ゴミ屋敷の清掃は、専門的な知識と経験が必要です。AGAPEリサイクルでは、ゴミ屋敷の清掃、消毒、消臭まで一貫して対応可能です。まずはお気軽にご相談ください。
      例2: 遺品整理 -> 回答: 遺品整理は、故人の思い出を大切にしながら、不用品の分別・処分を行うデリケートな作業です。AGAPEリサイクルでは、遺品整理の専門サービスを提供しており、ご遺族の心に寄り添いながら丁寧に対応いたします。まずはお気軽にご相談ください。
      例3: 古いパソコンの処分 -> 回答: 古いパソコンは、個人情報保護の観点から適切な処理が必要です。自治体によっては回収していない場合もあります。AGAPEリサイクルでは、OA機器・家電リサイクルサービスで対応可能ですので、お気軽にお問い合わせください。
      例4: ペットボトル -> 回答: ペットボトルはプラスチック製容器包装としてリサイクル可能です。キャップとラベルを外し、中を軽くすすいでから指定の回収場所に出してください。AGAPEリサイクルでも回収可能ですので、大量の場合などはお気軽にお問い合わせください。
      お困りごと: ${item}`;

      chatHistory.push({ role: "user", parts: [{ text: prompt }] });
      const payload = { contents: chatHistory };
      const apiKey = "" // If you want to use models other than gemini-2.5-flash-preview-05-20 or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (result.candidates && result.candidates.length > 0 &&
          result.candidates[0].content && result.candidates[0].content.parts &&
          result.candidates[0].content.parts.length > 0) {
        const text = result.candidates[0].content.parts[0].text;
        setDisposalInfo(text);
      } else {
        setDisposalInfo('情報を取得できませんでした。別の内容でお試しください。');
      }
    } catch (error) {
      console.error('Error calling Gemini API:', error);
      setDisposalInfo('情報の取得中にエラーが発生しました。時間をおいて再度お試しください。');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <section id="waste-assistant" className="py-16 bg-blue-50">
      <div className="container mx-auto px-4 text-center">
        <h2 className="text-3xl md:text-4xl font-bold mb-8 text-blue-700 flex items-center justify-center">
          <Search className="inline-block w-8 h-8 mr-2 text-blue-600" />
          ごみのお悩み検索
        </h2>
        <p className="text-lg text-gray-700 mb-6">
          お困りごとの内容を入力すると、適切な解決策や関連サービスをご案内します。
        </p>
        <div className="max-w-xl mx-auto flex flex-col md:flex-row gap-4">
          <input
            type="text"
            className="flex-grow p-3 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"
            placeholder="例: ゴミ屋敷、遺品整理、古いパソコンの処分"
            value={item}
            onChange={(e) => setItem(e.target.value)}
            onKeyPress={(e) => {
              if (e.key === 'Enter') {
                getDisposalInfo();
              }
            }}
          />
          <button
            onClick={getDisposalInfo}
            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300 transform hover:scale-105"
            disabled={isLoading}
          >
            {isLoading ? '検索中...' : '解決策を調べる'}
          </button>
        </div>
        {disposalInfo && (
          <div className="mt-8 p-6 bg-white rounded-lg shadow-md text-left max-w-xl mx-auto">
            <h3 className="text-xl font-semibold mb-3 text-blue-600">解決策・関連サービス:</h3>
            <p className="text-gray-800 whitespace-pre-wrap">{disposalInfo}</p>
          </div>
        )}
      </div>
    </section>
  );
};

// お問い合わせセクションコンポーネント
const ContactSection = () => {
  return (
    <section id="contact" className="py-16 bg-blue-700 text-white">
      <div className="container mx-auto px-4 text-center">
        <h2 className="text-3xl md:text-4xl font-bold mb-8">お問い合わせ</h2>
        <p className="text-lg md:text-xl mb-6">不用品や廃棄物に関するご相談、お見積もりなど、お気軽にお問い合わせください。</p>
        <div className="flex flex-col md:flex-row justify-center items-center space-y-6 md:space-y-0 md:space-x-12 mb-10">
          <div className="flex items-center">
            <svg className="w-8 h-8 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span className="text-2xl md:text-3xl font-bold">0120-86-0053</span>
          </div>
          {/* FAX番号を追加 (Lucide Iconは削除し、テキストのみにしました) */}
          <div className="flex items-center">
            {/* FaxアイコンはLucide-Reactに存在しないため、アイコンを削除しました */}
            <span className="text-2xl md:text-3xl font-bold">FAX: 072-808-8023</span>
          </div>
        </div>
        <p className="text-lg mb-8">受付時間：平日 9:00 - 18:00</p>
        {/* お問い合わせフォームへのボタンを削除しました */}
      </div>
    </section>
  );
};

// フッターコンポーネント
const Footer = () => {
  return (
    <footer className="bg-gray-800 text-white py-8">
      <div className="container mx-auto px-4 text-center text-sm">
        <p className="mb-4">&copy; {new Date().getFullYear()} 株式会社AGAPEリサイクル All Rights Reserved.</p>
        <div className="space-x-4">
          <a href="#" className="hover:text-blue-400 transition duration-300">プライバシーポリシー</a>
          <a href="#" className="hover:text-blue-400 transition duration-300">サイトマップ</a>
        </div>
      </div>
    </footer>
  );
};

// モバイル版のみ表示される固定フッターボタン
const MobileFixedFooterButtons = () => {
  return (
    <div className="fixed bottom-0 left-0 right-0 md:hidden bg-green-700 text-white z-50 flex">
      <a href="tel:0120-86-0053" className="flex-1 flex items-center justify-center py-3 border-r border-green-600 hover:bg-green-800 transition duration-300">
        <svg className="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
        </svg>
        <span>タップでお電話</span>
      </a>
      {/* お問い合わせボタンを削除しました */}
    </div>
  );
};

// Reactアプリケーションをレンダリング
export default App;
